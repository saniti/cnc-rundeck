- defaultTab: nodes
  description: Extract key information from POD definition.
  executionEnabled: true
  group: CNC/Configuration
  id: 0ea1cf89-2324-4106-a507-e934a732da8e
  loglevel: INFO
  name: get cnc pod details
  nodeFilterEditable: false
  options:
  - enforced: true
    label: Deployment
    name: cnc-pod
    required: true
    valuesUrl: file:/opt/cw/options/cw-environments.json
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: true
  sequence:
    commands:
    - description: get vars
      plugins:
        LogFilter:
        - config:
            captureMultipleKeysValues: 'true'
            hideOutput: 'false'
            logData: 'true'
            regex: ^(.+?)\s*=\s*(.+)
          type: key-value-data-multilines
      script: |
        mgtdns=$(jq -r '.[] | select(.name=="@option.cnc-pod@")."mgt-dns"' /opt/cw/options/cw-environments.json)
        datadns=$(jq -r '.[] | select(.name=="@option.cnc-pod@")."data-dns"' /opt/cw/options/cw-environments.json)
        datavip=$(jq -r '.[] | select(.name=="@option.cnc-pod@")."data-vip"' /opt/cw/options/cw-environments.json)
        mgtvip=$(jq -r '.[] | select(.name=="@option.cnc-pod@")."mgt-vip"' /opt/cw/options/cw-environments.json)

        if [ "$mgtdns" == "" ]; then echo mgtdns=none; else echo mgtdns=$mgtdns;  fi
        if [ "$datadns" == "" ]; then echo datadns=none; else echo datadns=$datadns;  fi
        if [ "$datavip" == "" ]; then echo datavip=none; else echo datavip=$datavip;  fi
        if [ "$mgtvip" == "" ]; then echo mgtvip=none; else echo mgtvip=$mgtvip;  fi
        if [ "$mgtvip" == "" ]; then echo cwvip=none; else echo cwvip=$mgtvip;  fi
    - configuration:
        export: mgtdns
        group: export
        value: ${data.mgtdns*}
      nodeStep: false
      type: export-var
    - configuration:
        export: datadns
        group: export
        value: ${data.datadns*}
      nodeStep: false
      type: export-var
    - configuration:
        export: datavip
        group: export
        value: ${data.datavip*}
      description: datavip
      nodeStep: false
      type: export-var
    - configuration:
        export: mgtvip
        group: export
        value: ${data.mgtvip*}
      description: mgtvip
      nodeStep: false
      type: export-var
    - configuration:
        export: cwvip
        group: export
        value: ${data.cwvip*}
      description: cwvip
      nodeStep: false
      type: export-var
    - configuration:
        debugOnly: 'true'
      nodeStep: false
      type: log-data-step
    - configuration:
        fail: 'false'
        halt: 'false'
      description: succeed regardless
      nodeStep: false
      type: flow-control
    keepgoing: true
    strategy: node-first
  uuid: 0ea1cf89-2324-4106-a507-e934a732da8e

