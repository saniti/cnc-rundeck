- defaultTab: nodes
  description: ''
  executionEnabled: true
  group: Kafka/99 - Callbacks
  id: ba36973f-ae30-4da5-a3bf-4feb903dc24f
  loglevel: INFO
  maxMultipleExecutions: '1'
  name: netbox - updates - vlan
  nodeFilterEditable: false
  notification:
    onfailure:
      email:
        recipients: autoamtion@microlab.dcloud.cisco.com
        subject: '${notification.eventStatus} :[${job.name}]: FAILURE: Service Deployment'
    onsuccess:
      email:
        recipients: autoamtion@microlab.dcloud.cisco.com
        subject: '${notification.eventStatus} :[${job.name}]: SUCCESS: Service Deployment'
  notifyAvgDurationThreshold: null
  options:
  - hidden: true
    name: netbox-server
    required: true
    secure: true
    storagePath: keys/netbox/netbox-host
    valueExposed: true
  - hidden: true
    name: api-token
    required: true
    secure: true
    storagePath: keys/netbox/netbox-token
    valueExposed: true
  - name: raw
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: true
  sequence:
    commands:
    - description: get values
      plugins:
        LogFilter:
        - config:
            captureMultipleKeysValues: 'true'
            hideOutput: 'false'
            logData: 'true'
            regex: ^(.+?)\s*=\s*(.+)
          type: key-value-data-multilines
      script: |
        echo '@option.raw@' | jq -r '.params[] |to_entries[] | ("input-"+(.key|tostring)+"="+(.value|tostring))'
        echo '@option.raw@' | jq -r '.data[][][] |to_entries[] | ("input-"+(.key|tostring)+"="+(.value|tostring))'
        echo '@option.raw@' | jq -r '.data|keys[0] | "service-model="+.|tostring'
        data=$(echo '@option.raw@' | jq -c '.data')
        echo service_data=$data
    - description: now
      plugins:
        LogFilter:
        - config:
            invalidKeyPattern: \s|\$|\{|\}|\\
            logData: 'true'
            name: now
            regex: (.*)
            replaceFilteredResult: 'false'
          type: key-value-data
      script: echo $(date +"%Y-%m-%d-%H-%M-%S")
    - configuration:
        authentication: None
        body: ${data.service_data*}
        checkResponseCode: 'false'
        headers: '{"Content-Type":"application/json","Authorization":"${option.api-token}"}'
        method: POST
        printResponse: 'false'
        printResponseToFile: 'false'
        proxySettings: 'false'
        remoteUrl: ${option.netbox-server}/ipam/vlans/
        sslVerify: 'false'
        timeout: '300000'
      description: Update item
      nodeStep: false
      type: edu.ohio.ais.rundeck.HttpWorkflowStepPlugin
    keepgoing: false
    strategy: sequential
  uuid: ba36973f-ae30-4da5-a3bf-4feb903dc24f

