- defaultTab: nodes
  description: ''
  executionEnabled: true
  group: -DEMO/2-CNC Device
  id: 5ffd7be9-9d7d-451b-9111-9ac074cb6425
  loglevel: INFO
  name: Initiate new netsim
  nodeFilterEditable: false
  nodefilters:
    dispatch:
      excludePrecedence: true
      keepgoing: false
      rankOrder: ascending
      successOnEmptyNodeFilter: false
      threadcount: '1'
    filter: 'name: dcloud-nso '
  nodesSelectedByDefault: true
  options:
  - description: '> Prefix for device. For example, demo- will create a device as
      demo-0, demo-1'
    label: Device Prefix
    name: device-prefix
    required: true
  - enforced: true
    label: Cisco NED
    name: device-type
    required: true
    valuesUrl: http://${option.proxy.value}/packages
  - label: Number of devices to create
    name: devicenum
    required: true
  - description: '> This will delete and clean existing netsim devices'
    enforced: true
    label: Restart Netsim
    name: clean
    required: true
    value: 'no'
    values:
    - 'yes'
    - 'no'
    valuesListDelimiter: ','
  - enforced: true
    label: Start?
    name: start
    required: true
    values:
    - 'no'
    - 'yes'
    valuesListDelimiter: ','
  - enforced: true
    hidden: true
    name: proxy
    required: true
    value: proxy:3001
    values:
    - proxy:3001
    valuesListDelimiter: ','
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: true
  sequence:
    commands:
    - description: clean if requested
      script: |-
        loadfile=/tmp/@job.execid@-devices.xml
        ncsrun=/home/cisco/ncs-run
        nsodir=/home/cisco/nso-5.7.6
        . $nsodir/ncsrc
        cd $ncsrun
        clean_netsim () {
            command $NCS_DIR/bin/ncs-netsim delete-network
        }

        if [ "@option.clean@" = "yes" ]; then clean_netsim; fi
    - description: Create netsim devices and onboard to NSO
      script: "loadfile=/tmp/@job.execid@-devices.xml\nncsrun=/home/cisco/ncs-run\n\
        nsodir=/home/cisco/nso-5.7.6\n. $nsodir/ncsrc\ncd $ncsrun\npwd\nenv\necho\
        \ ncs-netsim create-network $ncsrun/packages/@option.device-type@ @option.devicenum@\
        \ @option.device-prefix@\n\n#    echo Removing existing netsims ...\n#   \
        \ sudo -E -u cisco bash -c  '$NCS_DIR/bin/ncs-netsim stop'\n#    sudo -E -u\
        \ cisco bash -c  '$NCS_DIR/bin/ncs-netsim delete-network'\n#    sudo -E -u\
        \ cisco bash -c  '$NCS_DIR/bin/ncs-netsim create-network ./packages/@option.device-type@\
        \ @option.devicenum@ @option.device-prefix@'\n#    sudo -E -u cisco bash -c\
        \  '$NCS_DIR/bin/ncs-netsim ncs-xml-init > /tmp/@job.execid@-devices.xml'\n\
        #    sudo -E -u cisco bash -c  '$NCS_DIR/bin/ncs_load -l -m -F x /tmp/@job.execid@-devices.xml'\n\
        \n    echo Adding to existing netsim network ... \n    $NCS_DIR/bin/ncs-netsim\
        \ create-network $ncsrun/packages/@option.device-type@ @option.devicenum@\
        \ @option.device-prefix@\n    $NCS_DIR/bin/ncs-netsim ncs-xml-init > /tmp/@job.execid@-devices.xml\n\
        \    $NCS_DIR/bin/ncs_load -l -m -F x /tmp/@job.execid@-devices.xml\n"
    - description: start if requested
      script: |-
        loadfile=/tmp/@job.execid@-devices.xml
        ncsrun=/home/cisco/ncs-run
        nsodir=/home/cisco/nso-5.7.6
        . $nsodir/ncsrc
        cd $ncsrun
        start_netsim () {
        command $NCS_DIR/bin/ncs-netsim start
        }

        if [ "@option.start@" = "yes" ]; then start_netsim; fi
    - description: show netsims
      script: |2+

        ncsrun=/home/cisco/ncs-run
        nsodir=/home/cisco/nso-5.7.6
        . $nsodir/ncsrc
        cd $ncsrun

        $NCS_DIR/bin/ncs-netsim list

    keepgoing: false
    strategy: node-first
  uuid: 5ffd7be9-9d7d-451b-9111-9ac074cb6425

