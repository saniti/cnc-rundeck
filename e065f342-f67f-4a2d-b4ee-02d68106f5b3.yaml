- defaultTab: nodes
  description: |-
    Deploy a standard 3 node data gatewa cluster
    ## Features
    - IPAM integration
  executionEnabled: true
  group: CNC/Deploy/Batch
  id: e065f342-f67f-4a2d-b4ee-02d68106f5b3
  loglevel: INFO
  name: Deploy CDG 3 Node (simple)
  nodeFilterEditable: false
  options:
  - label: Name of the seed host
    name: VM-1-Name
    required: true
    value: cdg01
  - label: Name of the second host
    name: VM-2-Name
    required: true
    value: cdg02
  - label: Name of third cluster node
    name: VM-3-Name
    required: true
    value: cdg03
  - label: Upload VM Specification file
    name: vm01-spec
    type: file
  - label: Upload VM Specification file
    name: vm02-spec
    type: file
  - label: Upload VM Specification file
    name: vm03-spec
    type: file
  - enforced: true
    label: ESX Host (VM1)
    name: Host-1
    required: true
    valuesUrl: file:/tmp/hosts.json
  - enforced: true
    label: ESX Host (VM2)
    name: Host-2
    required: true
    valuesUrl: file:/tmp/hosts.json
  - enforced: true
    label: ESX Host (VM3)
    name: Host-3
    required: true
    valuesUrl: file:/tmp/hosts.json
  - enforced: true
    label: Datastore for VM1
    name: Datastore-1
    required: true
    valuesUrl: file:/tmp/datastores.json
  - enforced: true
    label: Datastore for VM2
    name: Datastore-2
    required: true
    valuesUrl: file:/tmp/datastores.json
  - enforced: true
    label: Datastore for VM3
    name: Datastore-3
    required: true
    valuesUrl: file:/tmp/datastores.json
  - hidden: true
    name: DNS
    required: true
    value: ' 192.168.203.198'
  - enforced: true
    name: DataNetwork
    required: true
    value: /HX-cluster/network/vm-network-413
    valuesUrl: file:/tmp/networks.json
  - hidden: true
    name: Image
    required: true
    value: /opt/cw/images/cw-na-dg-3.0.0-36-release-20211105.ova
    values:
    - /opt/cw/images/cw-na-dg-3.0.0-36-release-20211105.ova
    valuesListDelimiter: ','
  - enforced: true
    name: ManagementNetwork
    required: true
    value: /HX-cluster/network/vm-network-411
    valuesUrl: file:/tmp/networks.json
  - label: DNS VIP Name
    name: VIP-Name
    required: true
    value: cwvip.ntf.local
  - hidden: true
    name: dg-admin-password
    required: true
    secure: true
    storagePath: keys/cw/dg-admin
    valueExposed: true
  - hidden: true
    name: dg-user-password
    required: true
    secure: true
    storagePath: keys/cw/dg-operator
    valueExposed: true
  - enforced: true
    label: Number of CPUs
    name: vCPU
    required: true
    value: '8'
    values:
    - '16'
    - '2'
    - '4'
    - '8'
    valuesListDelimiter: ','
  - hidden: true
    name: vCenter-host
    required: true
    value: vcenter65.nbnncn.lab
  - hidden: true
    name: vCenter-passwd
    secure: true
    storagePath: keys/vmware/administrator-vc-local
    valueExposed: true
  - hidden: true
    name: vCenter-username
    required: true
    value: administrator@nbnncn.lab
  - enforced: true
    label: Memory in MB
    name: vMEM
    required: true
    value: '16392'
    values:
    - '16392'
    - '32768'
    - '4096'
    - '65536'
    - '8192'
    valuesListDelimiter: ','
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: true
  sequence:
    commands:
    - description: Create VM in Netbox
      jobref:
        args: -VM ${option.VM-1-Name}
        group: Netbox
        name: Add VM to NetBox
        uuid: acac2af5-f8a8-44d6-a8d7-d02b9356b452
    - description: Deploy node 1
      exec: govc import.ova -k -name=${option.VM-1-Name} -options=/tmp/${option.VM-1-Name}.json
        -ds=${option.Datastore-1} -host=${option.Host-1} -u ${option.vCenter-username}:${option.vCenter-passwd}@${option.vCenter-host}
        ${option.Image}
    - description: Set Resources
      exec: govc vm.change -k -vm ${option.VM-1-Name} -u ${option.vCenter-username}:${option.vCenter-passwd}@${option.vCenter-host}
        -c=${option.vCPU} -m=${option.vMEM}
    - description: Power UP
      exec: govc vm.power -k -u ${option.vCenter-username}:${option.vCenter-passwd}@${option.vCenter-host}
        -on ${option.VM-1-Name}
    - description: Create VM in Netbox
      jobref:
        args: -VM ${option.VM-2-Name}
        group: Netbox
        name: Add VM to NetBox
        uuid: acac2af5-f8a8-44d6-a8d7-d02b9356b452
    - description: Deploy node 2
      exec: govc import.ova -k -name=${option.VM-2-Name} -options=/tmp/${option.VM-2-Name}.json
        -ds=${option.Datastore-2} -host=${option.Host-2} -u ${option.vCenter-username}:${option.vCenter-passwd}@${option.vCenter-host}
        ${option.Image}
    - description: Set Resources
      exec: govc vm.change -k -vm ${option.VM-2-Name} -u ${option.vCenter-username}:${option.vCenter-passwd}@${option.vCenter-host}
        -c=${option.vCPU} -m=${option.vMEM}
    - description: Power UP
      exec: govc vm.power -k -u ${option.vCenter-username}:${option.vCenter-passwd}@${option.vCenter-host}
        -on ${option.VM-2-Name}
    - description: Create VM in Netbox
      jobref:
        args: -VM ${option.VM-3-Name}
        group: Netbox
        name: Add VM to NetBox
        uuid: acac2af5-f8a8-44d6-a8d7-d02b9356b452
    - description: Deploy node 3
      exec: govc import.ova -k -name=${option.VM-3-Name} -options=/tmp/${option.VM-3-Name}.json
        -ds=${option.Datastore-3} -host=${option.Host-3} -u ${option.vCenter-username}:${option.vCenter-passwd}@${option.vCenter-host}
        ${option.Image}
    - description: Set Resources
      exec: govc vm.change -k -vm ${option.VM-3-Name} -u ${option.vCenter-username}:${option.vCenter-passwd}@${option.vCenter-host}
        -c=${option.vCPU} -m=${option.vMEM}
    - description: Power UP
      exec: govc vm.power -k -u ${option.vCenter-username}:${option.vCenter-passwd}@${option.vCenter-host}
        -on ${option.VM-3-Name}
    keepgoing: false
    strategy: sequential
  uuid: e065f342-f67f-4a2d-b4ee-02d68106f5b3

