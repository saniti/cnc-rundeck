- defaultTab: nodes
  description: |
    Create a VM and attach an existing ISO file
  executionEnabled: true
  group: Virtual Machines
  id: 1d7a3829-b672-403b-bdb0-98a0ad26410d
  loglevel: INFO
  name: Deploy VM
  nodeFilterEditable: false
  options:
  - label: Name of the VM in vCenter / ESX
    name: VM-1-Name
    required: true
  - enforced: true
    label: Datastore for ISO files
    name: ISO_Datastore
    required: true
    valuesUrl: file:/opt/cw/options/ds-selected.json
  - description: '> Please re-run the job `Locate ISO files` to refresh this list.'
    enforced: true
    label: Name of ISO file
    name: iso-file
    required: true
    valuesUrl: file:/opt/cw/options/iso-files.json
  - description: '> Operating system type for the selected ISO image'
    enforced: true
    label: Operating System
    name: os-type
    required: true
    valuesUrl: file:/opt/cw/options/vmware-os-types.json
  - enforced: true
    label: ESX Host (VM1)
    name: Host-1
    required: true
    valuesUrl: file:/tmp/hosts.json
  - enforced: true
    label: Datastore for VM1
    name: Datastore-1
    required: true
    valuesUrl: file:/tmp/datastores.json
  - delimiter: ','
    enforced: true
    label: Networks To Attach
    multivalued: true
    name: networks
    value: Network (1)
    values:
    - Network (1)
    - Network (2)
    - Network (3)
    valuesListDelimiter: ','
  - enforced: true
    label: First Network
    name: network-1
    required: true
    valuesUrl: file:/tmp/networks.json
  - enforced: true
    label: Second Network
    name: network-2
    valuesUrl: file:/tmp/networks.json
  - hidden: true
    name: Image
    required: true
    value: /opt/cw/images/cw-na-platform-4.1.0-38-release-211108v2.ova
    values:
    - /opt/cw/images/cw-na-platform-4.1.0-38-release-211108v2.ova
    valuesListDelimiter: ','
  - enforced: true
    label: Number of CPUs
    name: vCPU
    required: true
    value: '2'
    values:
    - '16'
    - '2'
    - '4'
    - '8'
    valuesListDelimiter: ','
  - hidden: true
    name: vCenter-host
    required: true
    secure: true
    storagePath: keys/vmware/vc-address
    valueExposed: true
  - hidden: true
    name: vCenter-passwd
    secure: true
    storagePath: keys/vmware/vc-password
    valueExposed: true
  - hidden: true
    name: vCenter-username
    required: true
    secure: true
    storagePath: keys/vmware/vc-user
    valueExposed: true
  - enforced: true
    label: Disk Size in GB
    name: vDisk
    required: true
    value: 200GB
    values:
    - 100GB
    - 200GB
    - 400GB
    - 500GB
    valuesListDelimiter: ','
  - enforced: true
    label: Memory in MB
    name: vMEM
    required: true
    value: '4096'
    values:
    - '16392'
    - '32768'
    - '4096'
    - '65536'
    - '8192'
    valuesListDelimiter: ','
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: true
  sequence:
    commands:
    - description: ds-1
      exec: echo "${option.Datastore-1}"
      plugins:
        LogFilter:
        - config:
            invalidKeyPattern: \s|\$|\{|\}|\\
            logData: 'true'
            name: ds-1
            regex: .*\/([^\/]+$)
          type: key-value-data
    - description: host-1
      exec: echo "${option.Host-1}"
      plugins:
        LogFilter:
        - config:
            invalidKeyPattern: \s|\$|\{|\}|\\
            logData: 'true'
            name: host-1
            regex: .*\/([^\/]+$)
          type: key-value-data
    - description: iso-ds
      exec: echo "${option.ISO_Datastore}"
      plugins:
        LogFilter:
        - config:
            invalidKeyPattern: \s|\$|\{|\}|\\
            logData: 'true'
            name: iso-ds
            regex: .*\/([^\/]+$)
          type: key-value-data
    - description: network1
      exec: echo "${option.network-1}"
      plugins:
        LogFilter:
        - config:
            invalidKeyPattern: \s|\$|\{|\}|\\
            logData: 'true'
            name: net-1
            regex: .*\/([^\/]+$)
          type: key-value-data
    - description: iso-file
      exec: echo "${option.iso-file}"
      plugins:
        LogFilter:
        - config:
            invalidKeyPattern: \s|\$|\{|\}|\\
            logData: 'true'
            name: iso-file
            regex: .*].(.*)
          type: key-value-data
    - description: 'Create node #1'
      exec: govc vm.create -k -u '${option.vCenter-username}:${option.vCenter-passwd}@${option.vCenter-host}'
        -g=${option.os-type} -c=${option.vCPU} -m=${option.vMEM} -ds='${data.ds-1*}'
        -host='${data.host-1*}' -disk='${option.vDisk}' -net='${data.net-1*}' -disk-datastore='${data.ds-1*}'
        -iso-datastore='${data.iso-ds*}' -iso='${data.iso-file}'   '${option.VM-1-Name}'
    keepgoing: false
    strategy: sequential
  uuid: 1d7a3829-b672-403b-bdb0-98a0ad26410d

