[ {
  "defaultTab" : "nodes",
  "description" : "",
  "executionEnabled" : true,
  "group" : "Kafka",
  "id" : "20825565-b130-46e6-9d5a-afc59a54fe90",
  "loglevel" : "INFO",
  "name" : "callback",
  "nodeFilterEditable" : false,
  "options" : [ {
    "name" : "raw"
  } ],
  "plugins" : {
    "ExecutionLifecycle" : null
  },
  "scheduleEnabled" : true,
  "sequence" : {
    "commands" : [ {
      "description" : "get status",
      "plugins" : {
        "LogFilter" : [ {
          "config" : {
            "captureMultipleKeysValues" : "true",
            "hideOutput" : "false",
            "logData" : "true",
            "regex" : "^(.+?)\\s*=\\s*(.+)"
          },
          "type" : "key-value-data-multilines"
        } ]
      },
      "script" : "#echo '@option.raw@' | jq '. | {\"action\":.action,\"projectid\":.data.project.id,\"taskid\":.data.id,\"status\":.change.diff.status.to}'\naction=$(echo '@option.raw@' | jq -r '. | \"action\"+\"=\"+.action')\nprojectid=$(echo '@option.raw@' | jq -r '. | \"projectid\"+\"=\"+(.data.project.id|tostring)')\ntaskid=$(echo '@option.raw@' | jq -r '. | \"taskid\"+\"=\"+(.data.id|tostring)')\nstatus=$(echo '@option.raw@' | jq -r '. | \"status\"+\"=\"+(.change.diff.status.to|tostring)')\nsubject=$(echo '@option.raw@' | jq -r '. | \"taskname\"+\"=\"+(.data.subject|tostring)')\ncustomer=$(echo '@option.raw@' | jq -r '. | \"customer\"+\"=\"+(.data.project.name|tostring)')\n\necho $action\necho $projectid\necho $taskid\necho $status\necho $subject\necho $customer"
    }, {
      "description" : "update message",
      "jobref" : {
        "args" : "-token ${option.token} -taskid ${data.taskid*} -message ${data.*}",
        "group" : "Kafka",
        "name" : "taiga - update message",
        "nodeStep" : "true",
        "uuid" : "c6e3950b-333f-4bbf-b71d-86d604ffde04"
      }
    }, {
      "description" : "run if action=change and status=Ready",
      "errorhandler" : {
        "jobref" : {
          "group" : "Kafka",
          "ignoreNotifications" : true,
          "name" : "Health Check",
          "uuid" : "68fc503e-60e2-496e-8b05-e9b11dd4c261"
        },
        "keepgoingOnSuccess" : true
      },
      "plugins" : {
        "LogFilter" : [ {
          "config" : {
            "captureMultipleKeysValues" : "true",
            "hideOutput" : "false",
            "logData" : "true",
            "regex" : "^(.+?)\\s*=\\s*(.+)"
          },
          "type" : "key-value-data-multilines"
        } ]
      },
      "script" : "if [ \"@data.action*@\" == \"change\" ] && [ \"@data.status*@\" == \"Ready\" ]; then false; else true; fi"
    }, {
      "description" : "update message",
      "jobref" : {
        "args" : "-token ${option.token} -taskid ${data.taskid*} -message ${job.execid}",
        "group" : "Kafka",
        "name" : "taiga - update message",
        "nodeStep" : "true",
        "uuid" : "c6e3950b-333f-4bbf-b71d-86d604ffde04"
      }
    } ],
    "keepgoing" : true,
    "strategy" : "sequential"
  },
  "uuid" : "20825565-b130-46e6-9d5a-afc59a54fe90"
} ]
