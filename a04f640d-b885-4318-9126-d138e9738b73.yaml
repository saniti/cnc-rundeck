- defaultTab: nodes
  description: ''
  executionEnabled: true
  group: Kafka
  id: a04f640d-b885-4318-9126-d138e9738b73
  loglevel: INFO
  maxMultipleExecutions: '10'
  multipleExecutions: true
  name: taita - task callback
  nodeFilterEditable: false
  options:
  - name: raw
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: true
  sequence:
    commands:
    - description: get status
      plugins:
        LogFilter:
        - config:
            captureMultipleKeysValues: 'true'
            hideOutput: 'false'
            logData: 'true'
            regex: ^(.+?)\s*=\s*(.+)
          type: key-value-data-multilines
      script: |-
        #echo '@option.raw@' | jq '. | {"action":.action,"projectid":.data.project.id,"taskid":.data.id,"status":.change.diff.status.to}'
        action=$(echo '@option.raw@' | jq -r '. | "action"+"="+.action')
        projectid=$(echo '@option.raw@' | jq -r '. | "projectid"+"="+(.data.project.id|tostring)')
        taskid=$(echo '@option.raw@' | jq -r '. | "taskid"+"="+(.data.id|tostring)')
        status=$(echo '@option.raw@' | jq -r '. | "status"+"="+(.change.diff.status.to|tostring)')
        subject=$(echo '@option.raw@' | jq -r '. | "taskname"+"="+(.data.subject|tostring)')
        customer=$(echo '@option.raw@' | jq -r '. | "customer"+"="+(.data.project.name|tostring)')

        echo $action
        echo $projectid
        echo $taskid
        echo $status
        echo $subject
        echo $customer
    - description: auth
      jobref:
        group: Kafka
        name: taiga - auth
        uuid: 18f1cfcf-0cc7-4ed3-b29d-d0600a425e7f
    - description: update message
      jobref:
        args: -key ${data.action*} -input ${option.raw} -customer ${data.customer*}
        group: Kafka
        name: Kafka demo
        uuid: e34069a6-bd11-446c-9938-06fe1e9c274a
    - description: run if action=change and status=Ready
      errorhandler:
        jobref:
          group: Kafka
          ignoreNotifications: true
          name: Health Check
          nodeStep: 'true'
          uuid: 68fc503e-60e2-496e-8b05-e9b11dd4c261
        keepgoingOnSuccess: true
      plugins:
        LogFilter:
        - config:
            captureMultipleKeysValues: 'true'
            hideOutput: 'false'
            logData: 'true'
            regex: ^(.+?)\s*=\s*(.+)
          type: key-value-data-multilines
      script: if [ "@data.action*@" == "change" ] && [ "@data.status*@" == "Ready"
        ]; then false; else true; fi
    - configuration:
        debugOnly: 'false'
      description: log data
      nodeStep: false
      type: log-data-step
    keepgoing: false
    strategy: node-first
  uuid: a04f640d-b885-4318-9126-d138e9738b73

