- defaultTab: nodes
  description: "Uses `nso` to generate a topology from the live network, and converts\
    \ into mermaid (markdown) format for WIKI page. \n---\n### Wiki Page\n[Topology](http://198.18.133.102:3000/simon/demo/wiki/Topology)"
  executionEnabled: true
  group: -DEMO
  id: 0578ae7c-3e59-4e71-91a4-b2a9a68952ee
  loglevel: INFO
  name: show topoloogy
  nodeFilterEditable: false
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: true
  sequence:
    commands:
    - configuration:
        authentication: None
        checkResponseCode: 'false'
        file: /opt/cw/tmp/nso-topology.json
        headers: '{"accept": "application/json"}'
        method: GET
        printResponse: 'true'
        printResponseToFile: 'true'
        proxySettings: 'false'
        remoteUrl: http://proxy:7000/devices/topology
        sslVerify: 'false'
        timeout: '1000000'
      description: Get Topology
      nodeStep: false
      type: edu.ohio.ais.rundeck.HttpWorkflowStepPlugin
    - description: jq and save
      plugins:
        LogFilter:
        - config:
            datatype: application/json
            sanitizeHtml: 'true'
            striped: 'true'
          type: render-datatype
      script: |-
        file=/opt/cw/tmp/nso-topology.json
        jq '[.[] | to_entries[] | {"name":.value.name,"value":.value.name}]' $file
    - description: Build topology file
      plugins:
        LogFilter:
        - config:
            datatype: application/json
            sanitizeHtml: 'true'
            striped: 'true'
          type: render-datatype
      script: |-
        file=/opt/cw/tmp/nso-topology.json
        outfile=/opt/cw/tmp/nso-topology-out.json
        echo '```mermaid' > $outfile
        echo 'flowchart LR' >> $outfile
        echo '%% updated: ' `date` >> $outfile
        jq -r '(.[][]| .name as $name | (..|select(has("live-status"))?) |."live-status"[][][] | (."device-id"|split(".")[0] | .|split("(")[0]) as $remote | $name+" x--x|<- "+."local-interface"+"<br>"+."port-id"+" ->|"+$remote)' $file >> $outfile
        echo '```' >> $outfile
    - description: Show file
      exec: cat /opt/cw/tmp/nso-topology-out.json
    - jobref:
        args: -repo simon/demo -branch develop -file-path /opt/cw/tmp/nso-topology-out.json
          -file-name Topology -message "updated"
        group: git
        name: git - replace wiki file v2
        uuid: e81b5233-73ba-40a0-bc17-f6a78e606c30
    keepgoing: false
    strategy: node-first
  uuid: 0578ae7c-3e59-4e71-91a4-b2a9a68952ee

