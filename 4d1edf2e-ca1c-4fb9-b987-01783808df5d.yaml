- defaultTab: nodes
  description: ''
  executionEnabled: true
  group: NSO/Configure
  id: 4d1edf2e-ca1c-4fb9-b987-01783808df5d
  loglevel: INFO
  name: '- Show NSO release'
  nodeFilterEditable: false
  options:
  - enforced: true
    label: Deployment type
    name: type
    required: true
    value: nso
    values:
    - nso
    valuesListDelimiter: ','
  - enforced: true
    label: Deployment
    name: deployment
    required: true
    valuesUrl: file:/opt/cw/deploy/${option.type.value}-deployments.json
  - enforced: true
    label: Show deployment but don't deploy
    name: show
    required: true
    value: 'true'
    values:
    - 'true'
    valuesListDelimiter: ','
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: true
  sequence:
    commands:
    - description: deployment properties
      plugins:
        LogFilter:
        - config:
            captureMultipleKeysValues: 'true'
            hideOutput: 'true'
            logData: 'true'
            regex: ^(.+?)\s*=\s*(.+)
          type: key-value-data-multilines
      script: |-
        infile=/opt/cw/deploy/@option.type@-deployments.json

        dep=$(jq --raw-output '..|objects|select(has("value") and .value=="@option.deployment@")' $infile)

        echo $dep | jq --raw-output '(..|objects|select(has("data"))."data") | del(..|objects|select(has("options"))."options") | to_entries[] | [(("deploy-"+.key)|tostring),(.value|tostring)]|join("=")'
        echo $dep | jq --raw-output '(..|objects|select(has("options"))."options")  | to_entries[] | [(("option-"+.key)|tostring),(.value|tostring)]|join("=")'
    - description: deployment script
      script: cat @data.deploy-script*@
    keepgoing: false
    strategy: node-first
  uuid: 4d1edf2e-ca1c-4fb9-b987-01783808df5d

