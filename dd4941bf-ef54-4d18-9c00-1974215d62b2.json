[ {
  "defaultTab" : "nodes",
  "description" : "> Upload a file into VMware environment\n",
  "executionEnabled" : true,
  "group" : "Virtual Machines",
  "id" : "dd4941bf-ef54-4d18-9c00-1974215d62b2",
  "loglevel" : "INFO",
  "name" : "Upload ISO OVA file to VMware or ESX",
  "nodeFilterEditable" : false,
  "options" : [ {
    "enforced" : true,
    "hidden" : true,
    "name" : "path",
    "required" : true,
    "value" : "/backup/keys/keys/vmware",
    "values" : [ "/backup/keys/keys/vmware" ],
    "valuesListDelimiter" : ","
  }, {
    "enforced" : true,
    "label" : "Environment",
    "name" : "scope",
    "required" : true,
    "valuesUrl" : "file:/opt/cw/options/vmw-environments.json"
  }, {
    "description" : "> Please re-run the job `Locate images on file system` to refresh this list.",
    "enforced" : true,
    "label" : "File to upload",
    "name" : "image-file",
    "required" : true,
    "valuesUrl" : "file:/opt/cw/options/images-files-all.json"
  }, {
    "label" : "Folder witin selected Datastore",
    "name" : "folder",
    "required" : true,
    "value" : "images",
    "values" : [ "images" ],
    "valuesListDelimiter" : ","
  }, {
    "enforced" : true,
    "label" : "Datastore for Image",
    "name" : "datastore",
    "required" : true,
    "valuesUrl" : "file:/tmp/${option.scope.value}-datastores.json"
  } ],
  "plugins" : {
    "ExecutionLifecycle" : null
  },
  "scheduleEnabled" : true,
  "sequence" : {
    "commands" : [ {
      "description" : "get vars",
      "plugins" : {
        "LogFilter" : [ {
          "config" : {
            "captureMultipleKeysValues" : "true",
            "hideOutput" : "false",
            "logData" : "true",
            "regex" : "^(.+?)\\s*=\\s*(.+)"
          },
          "type" : "key-value-data-multilines"
        } ]
      },
      "script" : "filein=/opt/cw/options/vmw-environments.json\n#jq -r '.[] | select(.name==\"@option.cnc-vip@\").\"mgt-vip\"' /opt/cw/options/cw-environments.json \njq --raw-output '.[] | select(.name==\"@option.scope@\") | to_entries[] |  [.key,.value]|join(\"=\")' $filein"
    }, {
      "description" : "GOVC variables",
      "plugins" : {
        "LogFilter" : [ {
          "config" : {
            "captureMultipleKeysValues" : "true",
            "hideOutput" : "false",
            "logData" : "true",
            "regex" : "^(.+?)\\s*=\\s*(.+)"
          },
          "type" : "key-value-data-multilines"
        } ]
      },
      "script" : "echo GOVC_URL=$(cat @option.path@/@data.proxy*@-vc-address)\necho GOVC_USERNAME=$(cat @option.path@/@data.proxy*@-vc-user)\necho GOVC_PASSWORD=$(cat @option.path@/@data.proxy*@-vc-password)\necho GOVC_INSECURE=1"
    }, {
      "description" : "image-file",
      "exec" : "echo \"${option.image-file}\"",
      "plugins" : {
        "LogFilter" : [ {
          "config" : {
            "invalidKeyPattern" : "\\s|\\$|\\{|\\}|\\\\",
            "logData" : "true",
            "name" : "iso-file",
            "regex" : ".*\\/([^\\/]+$)"
          },
          "type" : "key-value-data"
        } ]
      }
    }, {
      "description" : "Upload file",
      "plugins" : {
        "LogFilter" : [ {
          "config" : {
            "captureMultipleKeysValues" : "true",
            "hideOutput" : "false",
            "logData" : "true",
            "regex" : "^(.+?)\\s*=\\s*(.+)"
          },
          "type" : "key-value-data-multilines"
        } ]
      },
      "script" : "export GOVC_URL=@data.GOVC_URL*@\nexport GOVC_USERNAME=@data.GOVC_USERNAME*@\nexport GOVC_PASSWORD=@data.GOVC_PASSWORD*@\nexport GOVC_INSECURE=@data.GOVC_INSECURE*@\n\necho govc datastore.upload -k -ds '@option.datastore@' '@option.image-file@'  '/@option.folder@/@data.iso-file*@'\ngovc datastore.upload -k -ds '@option.datastore@' '@option.image-file@'  '/@option.folder@/@data.iso-file*@'\n\n"
    } ],
    "keepgoing" : false,
    "strategy" : "sequential"
  },
  "uuid" : "dd4941bf-ef54-4d18-9c00-1974215d62b2"
} ]
