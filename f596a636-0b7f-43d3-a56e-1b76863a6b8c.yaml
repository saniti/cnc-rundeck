- defaultTab: nodes
  description: |-
    Re-deploy a service
    ---
    1. [Reconcile Devices](2a4c8bfb-c00b-40b2-b722-abe42f0be3c4)
  executionEnabled: true
  group: -DEMO/L3VPN
  id: f596a636-0b7f-43d3-a56e-1b76863a6b8c
  loglevel: INFO
  name: 2 - L3VPN Service - Deploy
  nodeFilterEditable: false
  options:
  - enforced: true
    hidden: true
    name: proxy
    required: true
    value: proxy:3001
    values:
    - proxy:3001
    valuesListDelimiter: ','
  - enforced: true
    label: CW POD
    name: cnc-pod
    required: true
    valuesUrl: file:/opt/cw/options/cw-environments.json
  - enforced: true
    label: Action
    name: action
    required: true
    value: check-sync
    values:
    - check-sync
    - re-deploy
    valuesListDelimiter: ','
  - enforced: true
    label: Deploy Options
    name: dry-run-options
    required: true
    valuesUrl: file:/opt/cw/options/nso-commit-deploy-options.json
  - enforced: true
    label: VPN instance name
    name: name
    required: true
    valuesUrl: http://${option.proxy.value}/nso/vpnservices/l3vpn
  - enforced: true
    name: service
    required: true
    value: ietf-l3vpn-ntw:l3vpn-ntw
    values:
    - ietf-l3vpn-ntw:l3vpn-ntw
    valuesListDelimiter: ','
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: true
  sequence:
    commands:
    - description: check for dry-run
      plugins:
        LogFilter:
        - config:
            captureMultipleKeysValues: 'true'
            hideOutput: 'false'
            logData: 'true'
            regex: ^(.+?)\s*=\s*(.+)
          type: key-value-data-multilines
      script: "if [ \"@option.dry-run-options@\" == \"commit\" ]\nthen \n    COMMIT=\n\
        elif [ \"@option.action@\" == \"check-sync\" ]\nthen\n    COMMIT=\nelse\n\
        \    jq -ncr '{\"dry-run\":{\"outformat\":\"@option.dry-run-options@\"}} |\
        \ [\"COMMIT\",.|tostring]|join(\"=\")'\n    \nfi"
    - description: get cnc config
      jobref:
        group: CNC/Configuration
        importOptions: true
        name: get key vars v3
        uuid: c3b0db66-3fdd-49b7-a5b5-4261a0ff3463
    - configuration:
        authentication: None
        body: ${data.COMMIT*}
        checkResponseCode: 'false'
        headers: '{"Content-Type": "application/yang-data+json","Authorization": "Bearer
          ${export.cwtoken}"}'
        method: POST
        printResponse: 'true'
        printResponseToFile: 'false'
        proxySettings: 'false'
        remoteUrl: https://${export.mgtvip}:30603/crosswork/proxy/nso/restconf/data/${option.service}/vpn-services/vpn-service=${option.name}/${option.action}
        sslVerify: 'false'
        timeout: '30000'
      description: update service
      nodeStep: false
      plugins:
        LogFilter:
        - config:
            datatype: application/json
            sanitizeHtml: 'true'
            striped: 'false'
          type: render-datatype
      type: edu.ohio.ais.rundeck.HttpWorkflowStepPlugin
    keepgoing: false
    strategy: sequential
  uuid: f596a636-0b7f-43d3-a56e-1b76863a6b8c

