[ {
  "defaultTab" : "nodes",
  "description" : "Locates all the relevant infrastructure paths within the connected vCenter or ESX environment\n---\n## Requirements\n### Credentials\n* `keys/vmware/vc-address` - FQDN or IP address of the vCenter server\n* `keys/vmware/vc-user` - User associated with `vc-address`\n* `keys/vmware/vc-password` - Password for vCenter user account\n### Tooling\n* `govc` command line tool\n\n\n## Functionality\n```\n- use `govc` to discover all hosts, datastores and networks within the vCenter environment\n- store these as JSON files, to be used as inputs into other services such as provisioning\n```",
  "executionEnabled" : false,
  "group" : "CNC/Setup",
  "id" : "92ae8994-5845-4148-bc98-488d709aca6b",
  "loglevel" : "INFO",
  "name" : "Discovery vCenter Paths",
  "nodeFilterEditable" : false,
  "options" : [ {
    "enforced" : true,
    "label" : "vCenter Server",
    "name" : "scope",
    "required" : true,
    "value" : "home",
    "values" : [ "home", "dcloud" ],
    "valuesListDelimiter" : ","
  }, {
    "enforced" : true,
    "label" : "vCenter Server",
    "name" : "scope_1",
    "required" : true,
    "value" : "home",
    "values" : [ "home", "dcloud" ],
    "valuesListDelimiter" : ",",
    "valuesUrl" : "file:/opt/cw/options/vmw-environments.json"
  }, {
    "label" : "Virtual Center Server",
    "name" : "VC-Server",
    "required" : true,
    "secure" : true,
    "storagePath" : "keys/vmware/vc-address",
    "valueExposed" : true
  }, {
    "enforced" : true,
    "label" : "VMware Type",
    "name" : "type",
    "required" : true,
    "value" : "vc",
    "values" : [ "esx", "vc" ],
    "valuesListDelimiter" : ","
  }, {
    "hidden" : true,
    "label" : "VirtualCenter password",
    "name" : "VCpassword",
    "required" : true,
    "secure" : true,
    "storagePath" : "keys/vmware/vc-password",
    "valueExposed" : true
  }, {
    "hidden" : true,
    "label" : "Virtual Center user name",
    "name" : "VCuser",
    "required" : true,
    "secure" : true,
    "storagePath" : "keys/vmware/vc-user",
    "valueExposed" : true
  }, {
    "label" : "Output Directory",
    "name" : "outputDir",
    "required" : true,
    "value" : "/tmp"
  } ],
  "plugins" : {
    "ExecutionLifecycle" : null
  },
  "scheduleEnabled" : true,
  "sequence" : {
    "commands" : [ {
      "exec" : "govc  find -k -json -u ${option.VCuser}:${option.VCpassword}@${option.VC-Server} .  "
    }, {
      "description" : "hosts",
      "exec" : "govc find -k -json -u ${option.VCuser}:${option.VCpassword}@${option.VC-Server} . -type h > ${option.outputDir}/hosts.json"
    }, {
      "configuration" : {
        "command" : "bash -c 'if [ \"${option.type}\" == \"vc\" ]; then true; else false; fi'"
      },
      "errorhandler" : {
        "keepgoingOnSuccess" : true,
        "script" : "jq -n '[\"-ESXHOST-\"]' > @option.outputDir@/hosts.json"
      },
      "nodeStep" : true,
      "type" : "localexec"
    }, {
      "description" : "datacenters",
      "exec" : "govc find -k -json -u ${option.VCuser}:${option.VCpassword}@${option.VC-Server} . -type d > ${option.outputDir}/dcs.json"
    }, {
      "description" : "Data stores",
      "exec" : "govc find -k -json -u ${option.VCuser}:${option.VCpassword}@${option.VC-Server} . -type s > ${option.outputDir}/datastores.json"
    }, {
      "description" : "Networks",
      "exec" : "govc find -k -json -u ${option.VCuser}:${option.VCpassword}@${option.VC-Server} . -type n > ${option.outputDir}/networks.json"
    }, {
      "description" : "VMware type - ESX or vCenter",
      "exec" : "echo ${option.type} >  ${option.outputDir}/vmwaretype.json"
    } ],
    "keepgoing" : false,
    "strategy" : "node-first"
  },
  "uuid" : "92ae8994-5845-4148-bc98-488d709aca6b"
} ]
