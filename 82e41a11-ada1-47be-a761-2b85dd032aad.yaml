- defaultTab: nodes
  description: Create a new definition of a VMware environment
  executionEnabled: true
  group: CNC/Setup
  id: 82e41a11-ada1-47be-a761-2b85dd032aad
  loglevel: INFO
  name: VMware CREATE environment
  nodeFilterEditable: false
  options:
  - label: Name of the VMware Deployment (Friendly)
    name: vmw-name
    required: true
  - description: '> Tag (NO SPACES or special characters!) to identify this VMware
      environment'
    label: Tag
    name: tag
    required: true
  - label: IP or DNS of VMware vCenter
    name: vmw-ip
    required: true
  - enforced: true
    label: vCenter/vSphere or ESX
    name: type
    required: true
    value: VC
    values:
    - VC
    - ESX
    valuesListDelimiter: ','
  - description: Default is `administrator@vsphere.local`
    label: Admin User Name
    name: vmw-username
    required: true
    value: admin
  - enforced: true
    label: Set Default
    name: default
    required: true
    value: 'false'
    values:
    - 'false'
    - 'true'
    valuesListDelimiter: ','
  - delimiter: ','
    label: List Current Environments
    multivalued: true
    name: environments-current
    valuesUrl: file:/opt/cw/options/vmw-environments.json
  plugins:
    ExecutionLifecycle: {}
  scheduleEnabled: true
  sequence:
    commands:
    - configuration:
        debugOnly: 'false'
      nodeStep: false
      type: log-data-step
    - description: Add new entry
      script: |+
        file=/opt/cw/options/vmw-environments.json

        filetmp=/opt/cw/tmp/vmw-environments.tmp
        echo '[{"name":"@option.vmw-name@","value":"@option.vmw-name@","selected":"@option.default@","vmw-ip":"@option.vmw-ip@","tag":"@option.tag@"}]'
        if [ ! -f "$file" ]; then echo '[]' > "$file"; fi
        if [ ! -f "$file" ]; then echo '[]' > "$filetmp"; fi
        echo 'files created'

        readin=$(jq . $file)

        data=$(jq -n '[{"name":"@option.vmw-name@","value":"@option.tag@","selected":"@option.default@","type":"@option.type@","vmw-ip":"@option.vmw-ip@","proxy":"@option.tag@","tag":"@option.tag@"}]')

        echo $data $readin | jq -s 'flatten(1)' > $file


    keepgoing: false
    strategy: node-first
  uuid: 82e41a11-ada1-47be-a761-2b85dd032aad

