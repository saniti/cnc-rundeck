[ {
  "defaultTab" : "nodes",
  "description" : "Create a new definition of a VMware environment",
  "executionEnabled" : true,
  "group" : "CNC/Setup",
  "id" : "76aca037-673f-4029-8de2-fba99e181282",
  "loglevel" : "INFO",
  "name" : "VMware CREATE credentials",
  "nodeFilterEditable" : false,
  "options" : [ {
    "enforced" : true,
    "hidden" : true,
    "name" : "path",
    "required" : true,
    "value" : "/backup/keys/keys/vmware",
    "values" : [ "/backup/keys/keys/vmware" ],
    "valuesListDelimiter" : ","
  }, {
    "enforced" : true,
    "label" : "Environment",
    "name" : "scope",
    "required" : true,
    "valuesUrl" : "file:/opt/cw/options/vmw-environments.json"
  }, {
    "label" : "vCenter/ESX user",
    "name" : "user",
    "required" : true
  }, {
    "label" : "vCenter/ESX user password",
    "name" : "password",
    "required" : true,
    "secure" : true,
    "valueExposed" : true
  } ],
  "plugins" : {
    "ExecutionLifecycle" : { }
  },
  "scheduleEnabled" : true,
  "sequence" : {
    "commands" : [ {
      "description" : "get vars",
      "plugins" : {
        "LogFilter" : [ {
          "config" : {
            "captureMultipleKeysValues" : "true",
            "hideOutput" : "false",
            "logData" : "true",
            "regex" : "^(.+?)\\s*=\\s*(.+)"
          },
          "type" : "key-value-data-multilines"
        } ]
      },
      "script" : "filein=/opt/cw/options/vmw-environments.json\njq --raw-output '.[] | select(.name==\"@option.scope@\") | to_entries[] |  [.key,.value]|join(\"=\")' $filein"
    }, {
      "description" : "Set properties",
      "plugins" : {
        "LogFilter" : [ {
          "config" : {
            "captureMultipleKeysValues" : "true",
            "hideOutput" : "false",
            "logData" : "true",
            "regex" : "^(.+?)\\s*=\\s*(.+)"
          },
          "type" : "key-value-data-multilines"
        } ]
      },
      "script" : "echo GOVC_URL=$(cat @option.path@/@data.proxy*@-vc-address)\necho GOVC_USERNAME=$(cat @option.path@/@data.proxy*@-vc-user)\necho GOVC_PASSWORD=$(cat @option.path@/@data.proxy*@-vc-password)\necho GOVC_INSECURE=1\necho @data.vmw-ip@ > @option.path@/@data.proxy*@-vc-address\necho @option.user@ > @option.path@/@data.proxy*@-vc-user\necho @option.password@ > @option.path@/@data.proxy*@-vc-password\n"
    } ],
    "keepgoing" : false,
    "strategy" : "node-first"
  },
  "uuid" : "76aca037-673f-4029-8de2-fba99e181282"
} ]
