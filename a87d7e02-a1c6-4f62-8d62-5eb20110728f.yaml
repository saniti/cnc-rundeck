- defaultTab: nodes
  description: |-
    Do stuff
    [CM Authentication](1960ef3e-ddcc-4400-9012-259267f7399b)
  executionEnabled: true
  group: CML
  id: a87d7e02-a1c6-4f62-8d62-5eb20110728f
  loglevel: INFO
  name: CML - Lab
  nodeFilterEditable: false
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: true
  sequence:
    commands:
    - description: get auth
      jobref:
        group: CML
        name: CML - Auth
        uuid: 1960ef3e-ddcc-4400-9012-259267f7399b
    - configuration:
        command: echo ${export.cml-host}
      nodeStep: true
      type: localexec
    - configuration:
        authentication: None
        checkResponseCode: 'false'
        file: /opt/cw/tmp/${job.execid}-labs.json
        headers: '{"accept": "application/json","Authorization": "Bearer ${export.token}"}'
        method: GET
        printResponse: 'true'
        printResponseToFile: 'true'
        proxySettings: 'false'
        remoteUrl: ${export.cml-host}/api/v0/labs?show_all=true
        sslVerify: 'false'
        timeout: '30000'
      description: Get labs
      nodeStep: false
      type: edu.ohio.ais.rundeck.HttpWorkflowStepPlugin
    - configuration:
        command: jq -r '.[]' /opt/cw/tmp/${job.execid}-labs.json
      description: get Lab ID from CML instance
      nodeStep: true
      plugins:
        LogFilter:
        - config:
            invalidKeyPattern: \s|\$|\{|\}|\\
            logData: 'true'
            name: lab-id
            regex: (.*)
          type: key-value-data
      type: localexec
    - configuration:
        authentication: None
        checkResponseCode: 'false'
        file: /opt/cw/tmp/${job.execid}.json
        headers: '{"accept": "application/x-yaml","Authorization": "Bearer ${export.token}"}'
        method: GET
        printResponse: 'false'
        printResponseToFile: 'true'
        proxySettings: 'false'
        remoteUrl: ${export.cml-host}/api/v0/labs/${data.lab-id*}/download
        sslVerify: 'false'
        timeout: '30000'
      description: save
      nodeStep: false
      type: edu.ohio.ais.rundeck.HttpWorkflowStepPlugin
    - configuration:
        command: yq '.lab|.title' /opt/cw/tmp/${job.execid}.json
      description: Get Lab title
      nodeStep: true
      type: localexec
    keepgoing: false
    strategy: node-first
  uuid: a87d7e02-a1c6-4f62-8d62-5eb20110728f

