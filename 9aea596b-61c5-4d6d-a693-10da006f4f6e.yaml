- defaultTab: nodes
  description: Create a definition of the L3VPN
  executionEnabled: true
  group: -DEMO/L3VPN
  id: 9aea596b-61c5-4d6d-a693-10da006f4f6e
  loglevel: INFO
  name: L3VPN Definition - CREATE
  nodeFilterEditable: false
  notification:
    onsuccess:
      email:
        recipients: device-details@necehealthpoc.local
        subject: ${notification.eventStatus} ${job.name}
  notifyAvgDurationThreshold: null
  options:
  - enforced: true
    hidden: true
    name: proxy
    required: true
    value: proxy:3001
    values:
    - proxy:3001
    valuesListDelimiter: ','
  - enforced: true
    name: existing-vpn
    valuesUrl: file:/opt/cw/options/vpn-temp.json
  - enforced: true
    name: existingcolours
    valuesUrl: file:/opt/cw/options/${option.existing-vpn.value}-colours.json
  - description: VPN prefix. Appended with `vlan-id`. With defaults
    name: vpn-id
  - delimiter: ','
    description: '> List of SR Colours used'
    label: SR Colours
    multivalued: true
    name: sr-colours
    required: true
  - enforced: true
    name: f
    valuesUrl: file:/opt/cw/options/x.json
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: true
  sequence:
    commands:
    - description: Create Temp entry for VPN construction
      plugins:
        LogFilter:
        - config:
            captureMultipleKeysValues: 'true'
            hideOutput: 'false'
            logData: 'true'
            regex: ^(.+?)\s*=\s*(.+)
          type: key-value-data-multilines
      script: |+
        file=/opt/cw/options/vpn-temp.json
        filetmp=/opt/cw/options/vpn-temp.tmp
        servicefile=/opt/cw/options/vpn-temp-@option.vpn-id@.json
        servicefile2=/opt/cw/options/vpn-temp-@option.vpn-id@-colours.json
        staging=/opt/cw/tmp/staging-vpn

        if [ ! -f "$file" ]; then echo "[]" > "$file"; fi

        echo @option.sr-colours@  | jq --arg vpnid @option.vpn-id@ --raw-input '.|split(",")|{"vpn-id":$vpnid,"colours":.}|{"name":["vpn",$vpnid]|join("-"),"value":.}|[.]' > $servicefile

        jq --null-input --arg vpnid @option.vpn-id@ '["vpn","temp",$vpnid]|join("-")|{"name":.,"value":.} |[.]' > $filetmp
        jq -s '.[0] + .[1]' $file $filetmp > $staging
        \cp $staging $file

        echo @option.sr-colours@ | jq --raw-input '.|split(",")' > $servicefile2



    keepgoing: false
    strategy: sequential
  uuid: 9aea596b-61c5-4d6d-a693-10da006f4f6e

