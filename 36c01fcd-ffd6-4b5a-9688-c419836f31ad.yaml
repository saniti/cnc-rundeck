- defaultTab: nodes
  description: |-
    Do stuff
    [CM Authentication](1960ef3e-ddcc-4400-9012-259267f7399b)
  executionEnabled: true
  group: CML
  id: 36c01fcd-ffd6-4b5a-9688-c419836f31ad
  loglevel: INFO
  name: CML - show devices in lab
  nodeFilterEditable: false
  options:
  - enforced: true
    label: Existing Labs
    name: labs
    required: true
    valuesUrl: file:/opt/cw/options/cml-labs.json
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: true
  sequence:
    commands:
    - description: get auth
      jobref:
        group: CML
        name: CML - Auth
        uuid: 1960ef3e-ddcc-4400-9012-259267f7399b
    - configuration:
        authentication: None
        checkResponseCode: 'false'
        file: /opt/cw/tmp/${job.execid}-lab-${option.labs}.json
        headers: |+
          {"accept": "application/json","Authorization": "Bearer ${export.token}"}

        method: GET
        printResponse: 'true'
        printResponseToFile: 'true'
        proxySettings: 'false'
        remoteUrl: ${export.cml-host}/api/v0/labs/${option.labs}/nodes?data=true
        sslVerify: 'false'
        timeout: '30000'
      description: Get lab
      nodeStep: false
      type: edu.ohio.ais.rundeck.HttpWorkflowStepPlugin
    - description: create file
      script: |
        file=/opt/cw/tmp/@job.execid@-lab-@option.labs@.json
        outfile=/opt/cw/options/cml-lab-@option.labs@.json
        echo $file
        echo $outfile
        jq '[.[] | select(.tags[]=="router") | {"1-name":.label,"2-image":."image_definition","3-source":."node_definition","6-tags":.tags,"99-config":.configuration}] | sort' $file > $outfile
    - description: show labs - short
      plugins:
        LogFilter:
        - config:
            datatype: application/json
            sanitizeHtml: 'true'
            striped: 'true'
          type: render-datatype
      script: |-
        outfile=/opt/cw/options/cml-lab-@option.labs@.json
        jq '[.[] | del(."99-config")]' $outfile
    - description: show labs - long
      plugins:
        LogFilter:
        - config:
            datatype: application/json
            sanitizeHtml: 'true'
            striped: 'true'
          type: render-datatype
      script: |-
        outfile=/opt/cw/options/cml-lab-@option.labs@.json
        jq . $outfile
    keepgoing: false
    strategy: node-first
  uuid: 36c01fcd-ffd6-4b5a-9688-c419836f31ad

