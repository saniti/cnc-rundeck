- defaultTab: nodes
  description: |-
    Manage CNC version info.
    ---
    ## Expectations
    ### Images
    - Relevant images located under `/opt/cw/images` as OVA files
    ### Applications
    - Relevant applications located under `/opt/cw/install` as .tar.tz files
  executionEnabled: true
  group: CNC/Setup
  id: 1feb2b38-194d-4427-b9e9-b3c1a031a9b6
  loglevel: INFO
  name: CNC Version Management - add
  nodeFilterEditable: false
  options:
  - label: Friendly Name for Release
    name: friendly-name
    required: true
  - description: '> used for the on-disk location of data'
    label: Internal Name
    name: cnc-value
    required: true
  - label: CNC Core version
    name: cnc-version
    required: true
    value: '7.0'
    values:
    - '4.0'
    - '5.0'
    - '6.0'
    - '7.0'
    - '7.1'
    - '8.0'
    valuesListDelimiter: ','
  - label: Software Location (http)
    name: location-http
    required: true
    value: http://10.67.22.46:8002
    values:
    - /opt/cw/images
    - http://10.67.22.46:8002
    valuesListDelimiter: ','
  - label: Software Location (scp)
    name: location-scp
    required: true
    value: /opt/cw/images
    values:
    - /opt/cw/images
    - http://10.67.22.46:8002
    valuesListDelimiter: ','
  - description: '* leave blank for default'
    label: scp/ssh user
    name: scp-user
    secure: true
    storagePath: keys/useraccounts/remote_ssh_user
    valueExposed: true
  - description: '* leave blank for default'
    label: scp/ssh user
    name: scp-pass
    secure: true
    storagePath: keys/useraccounts/remote_ssh_pass
    valueExposed: true
  - description: |-
      > choose the CNC deployment image
      > [Update List](3ace6b49-f8c9-46f5-acac-8313ca5aa086)
    enforced: true
    label: CNC Deployment Image
    name: cnc-image-file
    required: true
    valuesUrl: file:/opt/cw/options/images-files-ova.json
  - description: '> Leave *blank* if not used. This will overwrite the on-disk location
      above'
    label: CNC Deployment Image (URL)
    name: cnc-image-file-url
  - description: |-
      > choose the CDG deployment image. Not required for Unified EMS
      > [Update List](3ace6b49-f8c9-46f5-acac-8313ca5aa086)
    enforced: true
    label: CDG Deployment Image
    name: cdg-image-file
    valuesUrl: file:/opt/cw/options/images-files-ova.json
  - description: 'Selected by default? `true` = yes, `false` = no.'
    enforced: true
    label: Set Default
    name: default
    required: true
    value: 'false'
    values:
    - 'false'
    - 'true'
    valuesListDelimiter: ','
  plugins:
    ExecutionLifecycle: {}
  scheduleEnabled: true
  sequence:
    commands:
    - description: Determine image file
      plugins:
        LogFilter:
        - config:
            captureMultipleKeysValues: 'true'
            hideOutput: 'false'
            logData: 'true'
            regex: ^(.+?)\s*=\s*(.+)
          type: key-value-data-multilines
      script: "if [ ! -z \"@option.cnc-image-file-url@\" ]\nthen \n    echo cnc-image=@option.cnc-image-file-url@\n\
        else\n    echo cnc-image=@option.cnc-image-file@\nfi"
    - description: Add new entry
      script: |
        file=/opt/cw/options/cw-versions.json
        filetmp=/opt/cw/tmp/cw-versions.tmp
        if [ ! -f "$file" ]; then echo "[]" > "$file"; fi
        jq '. += [{"name":"@option.friendly-name@","value":"@option.cnc-value@","friendly":"@option.friendly-name@","cnc-version":"@option.cnc-version@","location-http":"@option.location-http@/cnc/@option.cnc-version@","location-scp":"@option.location-scp@/cnc/@option.cnc-version@","scp-user":"@option.scp-user@","scp-pass":"@option.scp-pass@","cnc-image":"@data.cnc-image*@","cdg-image":"@option.cdg-image-file@","selected":@option.default@}]' $file > $filetmp
        \cp $filetmp $file
    keepgoing: false
    strategy: node-first
  uuid: 1feb2b38-194d-4427-b9e9-b3c1a031a9b6

