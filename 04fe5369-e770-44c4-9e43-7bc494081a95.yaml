- defaultTab: nodes
  description: |-
    CNC - Check Status of CA
    # Overview
    Determine the state of an asynchronous change automation job (child)
  executionEnabled: true
  group: CNC/Change Automations
  id: 04fe5369-e770-44c4-9e43-7bc494081a95
  loglevel: INFO
  name: CNC - Check Status
  nodeFilterEditable: false
  options:
  - enforced: true
    label: CNC POD
    name: cnc-vip
    required: true
    valuesUrl: file:/opt/cw/options/cw-environments.json
  - label: Job execution ID
    name: job-id
    required: true
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: true
  sequence:
    commands:
    - description: Get Vars
      jobref:
        args: -cnc-pod ${option.cnc-vip}
        group: CNC/Configuration
        ignoreNotifications: true
        importOptions: true
        name: get key vars
        uuid: c3b0db66-3fdd-49b7-a5b5-4261a0ff3463
    - configuration:
        authentication: None
        checkResponseCode: 'false'
        file: /opt/cw/tmp/${job.id}-ca-result.json
        headers: '{"Content-Type": "application/json","Authorization": "Bearer ${export.cwtoken}"}'
        method: GET
        printResponse: 'true'
        printResponseToFile: 'true'
        proxySettings: 'false'
        remoteUrl: https://${export.mgtvip}:30603/crosswork/nca/v1/mopjobs/sets/${option.job-id}
        sslVerify: 'false'
        timeout: '30000'
      description: check change automation status
      nodeStep: false
      plugins:
        LogFilter:
        - config:
            datatype: application/json
            sanitizeHtml: 'true'
            striped: 'false'
          type: render-datatype
        - config:
            invalidKeyPattern: \s|\$|\{|\}|\\
            logData: 'true'
            name: mm
            regex: (.*)
          type: key-value-data
      type: edu.ohio.ais.rundeck.HttpWorkflowStepPlugin
    - configuration:
        command: jq -r '.job_set.status' /opt/cw/tmp/${job.id}-ca-result.json
      description: status
      nodeStep: true
      plugins:
        LogFilter:
        - config:
            invalidKeyPattern: \s|\$|\{|\}|\\
            logData: 'true'
            name: status
            regex: (.*)
          type: key-value-data
      type: localexec
    - configuration:
        command: bash -c 'if [ "${data.status*}" == "SUCCEEDED" ] || [ "${data.status*}"
          == "FAILED" ]; then true; else false; fi
      description: continuing - neither success or failure
      errorhandler:
        jobref:
          args: -job-id ${option.job-id}
          group: CNC/Change Automations
          ignoreNotifications: true
          importOptions: true
          name: CNC - Check Status
          nodeStep: 'true'
          uuid: 04fe5369-e770-44c4-9e43-7bc494081a95
        keepgoingOnSuccess: true
      nodeStep: true
      type: localexec
    - configuration:
        command: bash -c 'if [ "${data.status*}" == "FAILED" ]; then false; else true;
          fi
      description: job failed
      errorhandler:
        configuration:
          fail: 'false'
          halt: 'false'
          status: Remote job failed
        keepgoingOnSuccess: true
        nodeStep: false
        type: flow-control
      nodeStep: true
      plugins:
        LogFilter:
        - config:
            datatype: application/json
            sanitizeHtml: 'true'
            striped: 'true'
          type: render-datatype
      type: localexec
    - configuration:
        command: bash -c 'if [ "${data.status*}" == "SUCCEEDED" ]; then true; else
          false; fi
      description: success
      errorhandler:
        configuration:
          fail: 'false'
          halt: 'false'
          status: nothing to see here
        keepgoingOnSuccess: true
        nodeStep: false
        type: flow-control
      nodeStep: true
      plugins:
        LogFilter:
        - config:
            invalidKeyPattern: \s|\$|\{|\}|\\
            logData: 'true'
            name: status1
            regex: (.*)
          type: key-value-data
      type: localexec
    keepgoing: true
    strategy: sequential
  uuid: 04fe5369-e770-44c4-9e43-7bc494081a95

