[ {
  "defaultTab" : "nodes",
  "description" : "retrieve NSO deployment details from /opt/cw/nso-versions.json",
  "executionEnabled" : true,
  "group" : "CNC/Configuration",
  "id" : "fae76fe9-6379-4cfb-9091-99e0d4470fcf",
  "loglevel" : "INFO",
  "name" : "get nso deployment properties",
  "nodeFilterEditable" : false,
  "options" : [ {
    "enforced" : true,
    "label" : "NSO Version",
    "name" : "nso-version",
    "required" : true,
    "valuesUrl" : "file:/opt/cw/options/nso-versions.json"
  }, {
    "hidden" : true,
    "name" : "file",
    "required" : true,
    "value" : "/opt/cw/options/nso-versions.json"
  } ],
  "plugins" : {
    "ExecutionLifecycle" : null
  },
  "scheduleEnabled" : true,
  "sequence" : {
    "commands" : [ {
      "description" : "get vars",
      "plugins" : {
        "LogFilter" : [ {
          "config" : {
            "captureMultipleKeysValues" : "true",
            "hideOutput" : "false",
            "logData" : "true",
            "regex" : "^(.+?)\\s*=\\s*(.+)"
          },
          "type" : "key-value-data-multilines"
        } ]
      },
      "script" : "jq -r '.[] | select(.value==\"@option.nso-version@\").\"nso-image\" | \"nso-image=\"+.' @option.file@\npackages=$(jq -r '.[] | select(.value==\"@option.nso-version@\").\"packages\"' @option.file@)\n#echo $packages\n#for i in $(echo $packages); do echo '{''\"'nso-package'\"':'\"'$(basename $i)'\"''}' ; done\nfor i in $(echo $packages | sed \"s/,/ /g\"); do echo packages=$i; done\n"
    }, {
      "configuration" : {
        "export" : "nso-image",
        "group" : "export",
        "value" : "${data.nso-image*}"
      },
      "description" : "nso-image",
      "nodeStep" : false,
      "type" : "export-var"
    }, {
      "configuration" : {
        "export" : "nso-packages",
        "group" : "export",
        "value" : "${data.packages*}"
      },
      "description" : "nso-packages",
      "nodeStep" : false,
      "type" : "export-var"
    }, {
      "configuration" : {
        "debugOnly" : "true"
      },
      "nodeStep" : false,
      "type" : "log-data-step"
    }, {
      "script" : "echo ---\necho \"@export.nso-packages@\"\necho ---\nfor i in `echo \"@export.nso-packages@\"`; do echo \"$i\"; done"
    } ],
    "keepgoing" : false,
    "strategy" : "node-first"
  },
  "uuid" : "fae76fe9-6379-4cfb-9091-99e0d4470fcf"
} ]
