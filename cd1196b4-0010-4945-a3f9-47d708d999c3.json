[ {
  "defaultTab" : "nodes",
  "description" : "",
  "executionEnabled" : true,
  "group" : "CNC/Configuration/Providers",
  "id" : "cd1196b4-0010-4945-a3f9-47d708d999c3",
  "loglevel" : "INFO",
  "name" : "CNC - Add Providers - NSO",
  "nodeFilterEditable" : false,
  "options" : [ {
    "enforced" : true,
    "name" : "cnc-vip",
    "required" : true,
    "valuesUrl" : "file:/opt/cw/options/cw-environments.json"
  }, {
    "description" : "- VIP or single IP",
    "label" : "NSO IP Address",
    "name" : "nso-ip",
    "required" : true
  }, {
    "label" : "NSO Netconf Port",
    "name" : "nso-netconf-port",
    "required" : true,
    "value" : "2022"
  }, {
    "label" : "NSO HTTPS Port",
    "name" : "nso-https-port",
    "required" : true,
    "value" : "8888"
  }, {
    "label" : "NSO Model Prefix",
    "name" : "nso-model-prefix",
    "required" : true,
    "value" : "Cisco-IOS-XR"
  }, {
    "label" : "NSO Model Version",
    "name" : "nso-model-version",
    "required" : true,
    "value" : "cisco-iosxr-cli-7.33"
  }, {
    "hidden" : true,
    "name" : "cnc-password",
    "required" : true,
    "secure" : true,
    "storagePath" : "keys/cw/admin",
    "valueExposed" : true
  }, {
    "hidden" : true,
    "label" : "CNC User Name",
    "name" : "cnc-user",
    "required" : true,
    "value" : "admin"
  }, {
    "description" : "paste data into this field",
    "hidden" : true,
    "label" : "Provider Data in JSON format",
    "name" : "provider-file",
    "value" : "x"
  }, {
    "description" : "This should be hidden",
    "hidden" : true,
    "name" : "provider-schema",
    "value" : "{\"providers\":[{\"name\":\"NSO_CNC\",\"connectivity_info\":[{\"type\":\"ROBOT_MSVC_TRANS_HTTPS\",\"ipaddrs\":[{\"inet_af\":\"ROBOT_INET_ADDR_TYPE_v4\",\"inet_addr\":\"0.0.0.0\",\"mask\":\"24\"}],\"port\":8888,\"timeout\":\"30\",\"reachability_state\":\"CONN_STATE_REACHABLE\"},{\"type\":\"ROBOT_MSVC_TRANS_NETCONF\",\"ipaddrs\":[{\"inet_af\":\"ROBOT_INET_ADDR_TYPE_v4\",\"inet_addr\":\"192.168.226.116\",\"mask\":\"24\"}],\"port\":2022,\"timeout\":\"30\"}],\"profile\":\"nso_creds\",\"supported_models\":[{\"model_prefix\":\"Cisco-IOS-XR\",\"model_version\":\"cisco-iosxr-cli-7.33\"}],\"family\":\"ROBOT_PROVIDER_NSO\",\"properties\":{\"ca_device_auth_nso\":\"ca_device_auth_nso\",\"cw_device_auth_nso\":\"cw_device_auth_nso\",\"forward\":\"true\"}}]}"
  } ],
  "plugins" : {
    "ExecutionLifecycle" : null
  },
  "scheduleEnabled" : true,
  "sequence" : {
    "commands" : [ {
      "description" : "CNC Auth",
      "jobref" : {
        "group" : "CNC",
        "importOptions" : true,
        "name" : "CNC - Auth",
        "uuid" : "5fee437d-4fa6-4728-9601-0fac3a061ca9"
      }
    }, {
      "configuration" : {
        "debugOnly" : "false"
      },
      "nodeStep" : false,
      "type" : "log-data-step"
    }, {
      "description" : "reconfigure JSON object",
      "plugins" : {
        "LogFilter" : [ {
          "config" : {
            "invalidKeyPattern" : "\\s|\\$|\\{|\\}|\\\\",
            "logData" : "true",
            "name" : "payload",
            "regex" : "(.*)"
          },
          "type" : "key-value-data"
        } ]
      },
      "script" : "file=/tmp/@job.execid@.json\ntmpfile=/tmp/@job.execid@.json.tmp\necho '@option.provider-schema@' > $file\njq '(..|objects|select(has(\"inet_addr\"))).\"inet_addr\"|= \"@option.nso-ip@\"' $file > $tmpfile\njq '(..|objects|select(has(\"model_prefix\"))).\"model_prefix\"|= \"@option.nso-model-prefix@\"' $tmpfile > $file\njq '(..|objects|select(has(\"model_version\"))).\"model_version\"|= \"@option.nso-model-version@\"' $file > $tmpfile\njq '( .providers[].connectivity_info[]|select(.type==\"ROBOT_MSVC_TRANS_NETCONF\") ).port|= @option.nso-netconf-port@' $tmpfile > $file\njq '( .providers[].connectivity_info[]|select(.type==\"ROBOT_MSVC_TRANS_HTTPS\") ).port|= @option.nso-https-port@' $file > $tmpfile\njq -c . $tmpfile"
    }, {
      "configuration" : {
        "authentication" : "None",
        "body" : "${data.payload*}",
        "checkResponseCode" : "true",
        "headers" : "{\"Content-Type\": \"application/json\",\"Authorization\": \"Bearer ${export.cnc-token}\"}",
        "method" : "POST",
        "printResponse" : "true",
        "printResponseToFile" : "false",
        "proxySettings" : "false",
        "remoteUrl" : "https://${export.cnc-vip}:30603/crosswork/inventory/v1/providers",
        "responseCode" : "200",
        "sslVerify" : "false",
        "timeout" : "30000"
      },
      "description" : "add providers",
      "nodeStep" : false,
      "type" : "edu.ohio.ais.rundeck.HttpWorkflowStepPlugin"
    } ],
    "keepgoing" : false,
    "strategy" : "node-first"
  },
  "uuid" : "cd1196b4-0010-4945-a3f9-47d708d999c3"
} ]
